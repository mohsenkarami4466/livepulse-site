# ุจุฑุฑุณ ฺฉุงูู ุฏฺฉูู ุณุงุฑ (FloatingDock)

## ุชุงุฑุฎ ุจุฑุฑุณ: 2025-12-06

## 1. ูุงูโูุง ูุฑุชุจุท

### 1.1 ฺฉุงููพูููุช ุงุตู
- **ูุณุฑ**: `src/components/FloatingDock/FloatingDock.jsx`
- **ูุถุนุช**: โ ููุฌูุฏ
- **CSS**: `src/components/FloatingDock/FloatingDock.css`
- **ูุถุนุช CSS**: โ ููุฌูุฏ

### 1.2 ุงุณุชูุงุฏู ุฏุฑ Layout
- **ูุณุฑ**: `src/components/Layout/Layout.jsx`
- **ุฎุท**: 204-208
- **ูุถุนุช**: โ ุงุณุชูุงุฏู ุดุฏู
- **Props ูพุงุณ ุฏุงุฏู ุดุฏู**:
  - `mode="page"`
  - `storageKey="floatingDockPos-page"`
  - `menuItems={dockMenuItems}`

### 1.3 ุงุณุชูุงุฏู ุฏุฑ Globe3DModal
- **ูุณุฑ**: `src/components/Globes/Globe3DModal.jsx`
- **ูุถุนุช**: โ ุงุณุชูุงุฏู ุดุฏู ุจุฑุง ฺฉุฑูโูุง 3D

## 2. ุชุนุฑู menuItems ุฏุฑ Layout.jsx

### 2.1 ูุญู ุชุนุฑู
- **ุฎุท**: 72-79
- **ููุน**: `React.useMemo`
- **ูุงุจุณุชฺฏ**: `[navigate]`

### 2.2 ูุญุชูุง menuItems
```javascript
const dockMenuItems = React.useMemo(() => ([
  { id: 'home', label: 'ุฎุงูู', icon: '๐', onClick: () => navigate('/') },
  { id: 'news', label: 'ุงุฎุจุงุฑ', icon: '๐ฐ', onClick: () => navigate('/news') },
  { id: 'globe', label: 'ฺฉุฑูโูุง', icon: '๐', onClick: () => navigate('/globe') },
  { id: 'tutorial', label: 'ุขููุฒุด', icon: '๐', onClick: () => navigate('/tutorial') },
  { id: 'relax', label: 'ุขุฑุงูุด', icon: '๐ง', onClick: () => navigate('/relax') },
  { id: 'tools', label: 'ุงุจุฒุงุฑูุง', icon: '๐๏ธ', onClick: () => navigate('/tools') }
]), [navigate])
```

### 2.3 ูุถุนุช
- โ ููู ุขุชูโูุง onClick ุฏุงุฑูุฏ
- โ ููู onClick ูุง ุงุฒ `navigate` ุงุณุชูุงุฏู ูโฺฉููุฏ
- โ ูุณุฑูุง ุฏุฑุณุช ูุณุชูุฏ

## 3. ุจุฑุฑุณ FloatingDock.jsx

### 3.1 Props ุฏุฑุงูุช ุดุฏู
- โ `mode` - ูพุดโูุฑุถ: 'page'
- โ `menuItems` - ูพุดโูุฑุถ: []
- โ `storageKey` - ูพุดโูุฑุถ: 'floatingDockPos'
- โ `containerRef` - ุงุฎุชุงุฑ
- โ `icon` - ุงุฎุชุงุฑ

### 3.2 State ูุง
- โ `isOpen` - ุจุฑุง ุจุงุฒ/ุจุณุชู ุจูุฏู ููู
- โ `pos` - ูููุนุช ุฏฺฉูู
- โ `dragState` - ูุถุนุช ุฏุฑฺฏ

### 3.3 Event Handlers

#### 3.3.1 handleClick (ุฎุท 216-221)
```javascript
const handleClick = (e) => {
  e.stopPropagation()
  if (!dragState.current.moved) {
    setIsOpen((v) => !v)
  }
}
```
- โ ุจุฑุง ุจุงุฒ/ุจุณุชู ฺฉุฑุฏู ููู ุจุง ฺฉูฺฉ ุฑู ุฏฺฉูู ุงุตู

#### 3.3.2 onClick ุฏฺฉููโูุง ููู (ุฎุท 300-321)
```javascript
onClick={(e) => {
  e.preventDefault()
  e.stopPropagation()
  e.stopImmediatePropagation()
  console.log('FloatingDock: ุฏฺฉูู ฺฉูฺฉ ุดุฏ:', item.id, item.label)
  if (item.onClick) {
    console.log('FloatingDock: ุงุฌุฑุง onClick ุจุฑุง:', item.id)
    try {
      item.onClick()
      console.log('FloatingDock: onClick ุงุฌุฑุง ุดุฏ')
    } catch (error) {
      console.error('FloatingDock: ุฎุทุง ุฏุฑ onClick:', error)
    }
  } else {
    console.warn('FloatingDock: onClick ุชุนุฑู ูุดุฏู ุจุฑุง:', item.id)
  }
  setTimeout(() => {
    setIsOpen(false)
  }, 50)
}}
```
- โ onClick ุชุนุฑู ุดุฏู
- โ stopPropagation ู stopImmediatePropagation ุงุณุชูุงุฏู ุดุฏู
- โ๏ธ **ูุดฺฉู ุงุญุชูุงู**: event listener ุจุฑุง ุจุณุชู ููู ููฺฉู ุงุณุช ูุจู ุงุฒ onClick ุงุฌุฑุง ุดูุฏ

### 3.4 Event Listener ุจุฑุง ุจุณุชู ููู (ุฎุท 230-253)
```javascript
useEffect(() => {
  if (!isOpen) return
  const handleClickOutside = (e) => {
    const menu = menuRef.current
    const btn = btnRef.current
    if (menu && menu.contains(e.target)) {
      return
    }
    if (btn && btn.contains(e.target)) {
      return
    }
    setIsOpen(false)
  }
  document.addEventListener('mousedown', handleClickOutside)
  document.addEventListener('touchstart', handleClickOutside)
  return () => {
    document.removeEventListener('mousedown', handleClickOutside)
    document.removeEventListener('touchstart', handleClickOutside)
  }
}, [isOpen])
```
- โ๏ธ **ูุดฺฉู**: ุงุณุชูุงุฏู ุงุฒ `mousedown` ู `touchstart` ููฺฉู ุงุณุช ุจุง `onClick` ุฏฺฉููโูุง ุชุฏุงุฎู ุฏุงุดุชู ุจุงุดุฏ
- โ๏ธ **ูุดฺฉู**: event listener ุฏุฑ bubble phase ุงุณุช ุงูุง ููฺฉู ุงุณุช ูุจู ุงุฒ onClick ุงุฌุฑุง ุดูุฏ

## 4. ูุดฺฉูุงุช ุดูุงุณุง ุดุฏู

### 4.1 ูุดฺฉู ุงุตู: Event Listener ุชุฏุงุฎู ุฏุงุฑุฏ
- **ุนูุช**: event listener ุจุฑุง ุจุณุชู ููู (`mousedown`/`touchstart`) ููฺฉู ุงุณุช ูุจู ุงุฒ `onClick` ุฏฺฉููโูุง ุงุฌุฑุง ุดูุฏ
- **ูุชุฌู**: onClick ุฏฺฉููโูุง ุงุฌุฑุง ููโุดูุฏ ุง ููู ูุจู ุงุฒ ุงุฌุฑุง onClick ุจุณุชู ูโุดูุฏ

### 4.2 ูุดฺฉู ุงุญุชูุงู: CSS z-index
- ููู: `z-index: 10060` (ุฏุฑ JS)
- ููู: `z-index: 9999` (ุฏุฑ CSS ูุฏู - ุจุงุฏ ุญุฐู ุดูุฏ)
- ุฏฺฉูู: `z-index: 10050`
- โ๏ธ ููฺฉู ุงุณุช ุนูุงุตุฑ ุฏฺฏุฑ ุฑู ููู ุจุงุดูุฏ

### 4.3 ูุดฺฉู ุงุญุชูุงู: pointer-events
- โ ุฏุฑ CSS: `pointer-events: auto !important` ุจุฑุง ููู ู ุฏฺฉููโูุง
- ุงูุง ููฺฉู ุงุณุช ุนูุงุตุฑ ูุงูุฏ `pointer-events: none` ุฏุงุดุชู ุจุงุดูุฏ

## 5. ุฑุงูโุญู ูพุดููุงุฏ

### 5.1 ุชุบุฑ Event Listener
- ุงุณุชูุงุฏู ุงุฒ `click` ุจู ุฌุง `mousedown`/`touchstart`
- ุงุถุงูู ฺฉุฑุฏู ุชุงุฎุฑ ุจุฑุง ุงุทููุงู ุงุฒ ุงุฌุฑุง onClick
- ุง ุงุณุชูุงุฏู ุงุฒ `capture: false` ู ุจุฑุฑุณ ุฏููโุชุฑ target

### 5.2 ุจูุจูุฏ onClick Handler
- ุญุฐู setTimeout ุจุฑุง ุจุณุชู ููู
- ุจุณุชู ููู ุจูุงูุงุตูู ุจุนุฏ ุงุฒ onClick (ุงูุง ุจุง ุชุงุฎุฑ ุฏุฑ event listener)

### 5.3 ุชุณุช ู Debug
- ุงุถุงูู ฺฉุฑุฏู console.log ุจุดุชุฑ
- ุจุฑุฑุณ ุงูฺฉู ุขุง menuItems ุฏุฑุณุช ูพุงุณ ุฏุงุฏู ูโุดูุฏ
- ุจุฑุฑุณ ุงูฺฉู ุขุง onClick ุงุตูุงู ูุฑุงุฎูุงู ูโุดูุฏ

## 6. ุงูุฏุงูุงุช ุงูุฌุงู ุดุฏู

1. โ ุจุฑุฑุณ ฺฉุงูู ฺฉุฏ ุงูุฌุงู ุดุฏ
2. โ ุงุตูุงุญ event listener - ุงุณุชูุงุฏู ุงุฒ `click` ุจุง `capture: true` ู ุชุงุฎุฑ 200ms
3. โ ุจูุจูุฏ onClick handler - ุงุถุงูู ฺฉุฑุฏู `data-clicking` attribute ุจุฑุง ุฌููฺฏุฑ ุงุฒ ุจุณุชู ุดุฏู ููู
4. โ ุงูุฒุงุด ุชุงุฎุฑ ุจุณุชู ููู ุจู 150ms ุจุฑุง ุงุทููุงู ุงุฒ ุงุฌุฑุง navigate
5. โณ ุชุณุช onClick - ูุงุฒ ุจู ุชุณุช ุชูุณุท ฺฉุงุฑุจุฑ
6. โณ ุญุฐู console.log ูุง debug ุจุนุฏ ุงุฒ ุชุงุฏ ฺฉุงุฑฺฉุฑุฏ

## 7. ุชุบุฑุงุช ุงุนูุงู ุดุฏู

### 7.1 Event Listener (ุฎุท 230-253)
- ุชุบุฑ ุงุฒ `mousedown`/`touchstart` ุจู `click` ุจุง `capture: true`
- ุงุถุงูู ฺฉุฑุฏู ุจุฑุฑุณ `data-clicking` attribute
- ุงูุฒุงุด ุชุงุฎุฑ ุจู 200ms

### 7.2 onClick Handler (ุฎุท 300-330)
- ุงุถุงูู ฺฉุฑุฏู `data-clicking` attribute ูุจู ุงุฒ ุงุฌุฑุง onClick
- ุงูุฒุงุด ุชุงุฎุฑ ุจุณุชู ููู ุจู 150ms
- ุญุฐู `data-clicking` ุจุนุฏ ุงุฒ ุจุณุชู ููู

## 8. ูุถุนุช ูุนู

- โ ฺฉุงููพูููุช FloatingDock ููุฌูุฏ ุงุณุช
- โ menuItems ุฏุฑ Layout ุชุนุฑู ุดุฏู
- โ onClick ูุง ุชุนุฑู ุดุฏูโุงูุฏ
- โ event listener ุงุตูุงุญ ุดุฏ
- โ onClick handler ุจูุจูุฏ ุงูุช
- โณ ูุงุฒ ุจู ุชุณุช ุชูุณุท ฺฉุงุฑุจุฑ ุจุฑุง ุชุงุฏ ฺฉุงุฑฺฉุฑุฏ

## 9. ูุญูู ุชุณุช

1. ุจุงุฒ ฺฉุฑุฏู ฺฉูุณูู ูุฑูุฑฺฏุฑ (F12)
2. ฺฉูฺฉ ุฑู ุฏฺฉูู ุณุงุฑ โ ููู ุจุงุฏ ุจุงุฒ ุดูุฏ
3. ฺฉูฺฉ ุฑู ฺฉ ุงุฒ ุฏฺฉููโูุง ููู (ูุซูุงู "ุฎุงูู")
4. ุจุฑุฑุณ ฺฉูุณูู ุจุฑุง ูพุงูโูุง:
   - `FloatingDock: ุฏฺฉูู ฺฉูฺฉ ุดุฏ: home ุฎุงูู`
   - `FloatingDock: ุงุฌุฑุง onClick ุจุฑุง: home`
   - `FloatingDock: onClick ุงุฌุฑุง ุดุฏ`
5. ุจุฑุฑุณ ุงูฺฉู ุขุง ุตูุญู ุชุบุฑ ฺฉุฑุฏู ุงุณุช ุง ูู

